<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.14">
  <compounddef id="websupport_8js" kind="file" language="C++">
    <compoundname>websupport.js</compoundname>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline><highlight class="normal">/*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>websupport.js</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>~~~~~~~~~~~~~</highlight></codeline>
<codeline><highlight class="normal"><sp/>*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>sphinx.websupport<sp/>utilties<sp/>for<sp/>all<sp/>documentation.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>:copyright:<sp/>Copyright<sp/>2007-2011<sp/>by<sp/>the<sp/>Sphinx<sp/>team,<sp/>see<sp/>AUTHORS.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>:license:<sp/>BSD,<sp/>see<sp/>LICENSE<sp/>for<sp/>details.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*/</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">(function($)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$.fn.autogrow<sp/>=<sp/>function()<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>return<sp/>this.each(function()<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>var<sp/>textarea<sp/>=<sp/>this;</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$.fn.autogrow.resize(textarea);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$(textarea)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>.focus(function()<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>textarea.interval<sp/>=<sp/>setInterval(function()<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$.fn.autogrow.resize(textarea);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>},<sp/>500);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>})</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>.blur(function()<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>clearInterval(textarea.interval);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>};</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>$.fn.autogrow.resize<sp/>=<sp/>function(textarea)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>var<sp/>lineHeight<sp/>=<sp/>parseInt($(textarea).css(&apos;line-height&apos;),<sp/>10);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>var<sp/>lines<sp/>=<sp/>textarea.value.split(&apos;\n&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>var<sp/>columns<sp/>=<sp/>textarea.cols;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>var<sp/>lineCount<sp/>=<sp/>0;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$.each(lines,<sp/>function()<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>lineCount<sp/>+=<sp/>Math.ceil(this.length<sp/>/<sp/>columns)<sp/>||<sp/>1;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>var<sp/>height<sp/>=<sp/>lineHeight<sp/>*<sp/>(lineCount<sp/>+<sp/>1);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$(textarea).css(&apos;height&apos;,<sp/>height);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>};</highlight></codeline>
<codeline><highlight class="normal">})(jQuery);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">(function($)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>var<sp/>comp,<sp/>by;</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>function<sp/>init()<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>initEvents();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>initComparator();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>function<sp/>initEvents()<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$(&apos;a.comment-close&apos;).live(&quot;click&quot;,<sp/>function(event)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>event.preventDefault();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>hide($(this).attr(&apos;id&apos;).substring(2));</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$(&apos;a.vote&apos;).live(&quot;click&quot;,<sp/>function(event)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>event.preventDefault();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>handleVote($(this));</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$(&apos;a.reply&apos;).live(&quot;click&quot;,<sp/>function(event)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>event.preventDefault();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>openReply($(this).attr(&apos;id&apos;).substring(2));</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$(&apos;a.close-reply&apos;).live(&quot;click&quot;,<sp/>function(event)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>event.preventDefault();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>closeReply($(this).attr(&apos;id&apos;).substring(2));</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$(&apos;a.sort-option&apos;).live(&quot;click&quot;,<sp/>function(event)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>event.preventDefault();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>handleReSort($(this));</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$(&apos;a.show-proposal&apos;).live(&quot;click&quot;,<sp/>function(event)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>event.preventDefault();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>showProposal($(this).attr(&apos;id&apos;).substring(2));</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$(&apos;a.hide-proposal&apos;).live(&quot;click&quot;,<sp/>function(event)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>event.preventDefault();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>hideProposal($(this).attr(&apos;id&apos;).substring(2));</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$(&apos;a.show-propose-change&apos;).live(&quot;click&quot;,<sp/>function(event)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>event.preventDefault();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>showProposeChange($(this).attr(&apos;id&apos;).substring(2));</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$(&apos;a.hide-propose-change&apos;).live(&quot;click&quot;,<sp/>function(event)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>event.preventDefault();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>hideProposeChange($(this).attr(&apos;id&apos;).substring(2));</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$(&apos;a.accept-comment&apos;).live(&quot;click&quot;,<sp/>function(event)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>event.preventDefault();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>acceptComment($(this).attr(&apos;id&apos;).substring(2));</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$(&apos;a.delete-comment&apos;).live(&quot;click&quot;,<sp/>function(event)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>event.preventDefault();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>deleteComment($(this).attr(&apos;id&apos;).substring(2));</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$(&apos;a.comment-markup&apos;).live(&quot;click&quot;,<sp/>function(event)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>event.preventDefault();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>toggleCommentMarkupBox($(this).attr(&apos;id&apos;).substring(2));</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>/**</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*<sp/>Set<sp/>comp,<sp/>which<sp/>is<sp/>a<sp/>comparator<sp/>function<sp/>used<sp/>for<sp/>sorting<sp/>and</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*<sp/>inserting<sp/>comments<sp/>into<sp/>the<sp/>list.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>function<sp/>setComparator()<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>If<sp/>the<sp/>first<sp/>three<sp/>letters<sp/>are<sp/>&quot;asc&quot;,<sp/>sort<sp/>in<sp/>ascending<sp/>order</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>and<sp/>remove<sp/>the<sp/>prefix.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>if<sp/>(by.substring(0,3)<sp/>==<sp/>&apos;asc&apos;)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>var<sp/>i<sp/>=<sp/>by.substring(3);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>comp<sp/>=<sp/>function(a,<sp/>b)<sp/>{<sp/>return<sp/>a[i]<sp/>-<sp/>b[i];<sp/>};</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/>else<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>Otherwise<sp/>sort<sp/>in<sp/>descending<sp/>order.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>comp<sp/>=<sp/>function(a,<sp/>b)<sp/>{<sp/>return<sp/>b[by]<sp/>-<sp/>a[by];<sp/>};</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>Reset<sp/>link<sp/>styles<sp/>and<sp/>format<sp/>the<sp/>selected<sp/>sort<sp/>option.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$(&apos;a.sel&apos;).attr(&apos;href&apos;,<sp/>&apos;#&apos;).removeClass(&apos;sel&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$(&apos;a.by&apos;<sp/>+<sp/>by).removeAttr(&apos;href&apos;).addClass(&apos;sel&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>/**</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*<sp/>Create<sp/>a<sp/>comp<sp/>function.<sp/>If<sp/>the<sp/>user<sp/>has<sp/>preferences<sp/>stored<sp/>in</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*<sp/>the<sp/>sortBy<sp/>cookie,<sp/>use<sp/>those,<sp/>otherwise<sp/>use<sp/>the<sp/>default.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>function<sp/>initComparator()<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>by<sp/>=<sp/>&apos;rating&apos;;<sp/>//<sp/>Default<sp/>to<sp/>sort<sp/>by<sp/>rating.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>If<sp/>the<sp/>sortBy<sp/>cookie<sp/>is<sp/>set,<sp/>use<sp/>that<sp/>instead.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>if<sp/>(document.cookie.length<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>var<sp/>start<sp/>=<sp/>document.cookie.indexOf(&apos;sortBy=&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>(start<sp/>!=<sp/>-1)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>start<sp/>=<sp/>start<sp/>+<sp/>7;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>var<sp/>end<sp/>=<sp/>document.cookie.indexOf(&quot;;&quot;,<sp/>start);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>(end<sp/>==<sp/>-1)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>end<sp/>=<sp/>document.cookie.length;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>by<sp/>=<sp/>unescape(document.cookie.substring(start,<sp/>end));</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>setComparator();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>/**</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*<sp/>Show<sp/>a<sp/>comment<sp/>div.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>function<sp/>show(id)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$(&apos;#ao&apos;<sp/>+<sp/>id).hide();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$(&apos;#ah&apos;<sp/>+<sp/>id).show();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>var<sp/>context<sp/>=<sp/>$.extend({id:<sp/>id},<sp/>opts);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>var<sp/>popup<sp/>=<sp/>$(renderTemplate(popupTemplate,<sp/>context)).hide();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>popup.find(&apos;textarea[name=&quot;proposal&quot;]&apos;).hide();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>popup.find(&apos;a.by&apos;<sp/>+<sp/>by).addClass(&apos;sel&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>var<sp/>form<sp/>=<sp/>popup.find(&apos;#cf&apos;<sp/>+<sp/>id);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>form.submit(function(event)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>event.preventDefault();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>addComment(form);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$(&apos;#s&apos;<sp/>+<sp/>id).after(popup);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>popup.slideDown(&apos;fast&apos;,<sp/>function()<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>getComments(id);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>/**</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*<sp/>Hide<sp/>a<sp/>comment<sp/>div.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>function<sp/>hide(id)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$(&apos;#ah&apos;<sp/>+<sp/>id).hide();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$(&apos;#ao&apos;<sp/>+<sp/>id).show();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>var<sp/>div<sp/>=<sp/>$(&apos;#sc&apos;<sp/>+<sp/>id);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>div.slideUp(&apos;fast&apos;,<sp/>function()<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>div.remove();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>/**</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*<sp/>Perform<sp/>an<sp/>ajax<sp/>request<sp/>to<sp/>get<sp/>comments<sp/>for<sp/>a<sp/>node</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*<sp/>and<sp/>insert<sp/>the<sp/>comments<sp/>into<sp/>the<sp/>comments<sp/>tree.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>function<sp/>getComments(id)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$.ajax({</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>type:<sp/>&apos;GET&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>url:<sp/>opts.getCommentsURL,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>data:<sp/>{node:<sp/>id},</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>success:<sp/>function(data,<sp/>textStatus,<sp/>request)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>var<sp/>ul<sp/>=<sp/>$(&apos;#cl&apos;<sp/>+<sp/>id);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>var<sp/>speed<sp/>=<sp/>100;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$(&apos;#cf&apos;<sp/>+<sp/>id)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.find(&apos;textarea[name=&quot;proposal&quot;]&apos;)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.data(&apos;source&apos;,<sp/>data.source);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>(data.comments.length<sp/>===<sp/>0)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ul.html(&apos;&lt;li&gt;No<sp/>comments<sp/>yet.&lt;/li&gt;&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ul.data(&apos;empty&apos;,<sp/>true);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/>else<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>If<sp/>there<sp/>are<sp/>comments,<sp/>sort<sp/>them<sp/>and<sp/>put<sp/>them<sp/>in<sp/>the<sp/>list.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>var<sp/>comments<sp/>=<sp/>sortComments(data.comments);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>speed<sp/>=<sp/>data.comments.length<sp/>*<sp/>100;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>appendComments(comments,<sp/>ul);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ul.data(&apos;empty&apos;,<sp/>false);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$(&apos;#cn&apos;<sp/>+<sp/>id).slideUp(speed<sp/>+<sp/>200);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ul.slideDown(speed);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>},</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>error:<sp/>function(request,<sp/>textStatus,<sp/>error)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>showError(&apos;Oops,<sp/>there<sp/>was<sp/>a<sp/>problem<sp/>retrieving<sp/>the<sp/>comments.&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>},</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>dataType:<sp/>&apos;json&apos;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>/**</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*<sp/>Add<sp/>a<sp/>comment<sp/>via<sp/>ajax<sp/>and<sp/>insert<sp/>the<sp/>comment<sp/>into<sp/>the<sp/>comment<sp/>tree.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>function<sp/>addComment(form)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>var<sp/>node_id<sp/>=<sp/>form.find(&apos;input[name=&quot;node&quot;]&apos;).val();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>var<sp/>parent_id<sp/>=<sp/>form.find(&apos;input[name=&quot;parent&quot;]&apos;).val();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>var<sp/>text<sp/>=<sp/>form.find(&apos;textarea[name=&quot;comment&quot;]&apos;).val();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>var<sp/>proposal<sp/>=<sp/>form.find(&apos;textarea[name=&quot;proposal&quot;]&apos;).val();</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>if<sp/>(text<sp/>==<sp/>&apos;&apos;)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>showError(&apos;Please<sp/>enter<sp/>a<sp/>comment.&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>return;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>Disable<sp/>the<sp/>form<sp/>that<sp/>is<sp/>being<sp/>submitted.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>form.find(&apos;textarea,input&apos;).attr(&apos;disabled&apos;,<sp/>&apos;disabled&apos;);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>Send<sp/>the<sp/>comment<sp/>to<sp/>the<sp/>server.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$.ajax({</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>type:<sp/>&quot;POST&quot;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>url:<sp/>opts.addCommentURL,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>dataType:<sp/>&apos;json&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>data:<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>node:<sp/>node_id,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>parent:<sp/>parent_id,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>text:<sp/>text,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>proposal:<sp/>proposal</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>},</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>success:<sp/>function(data,<sp/>textStatus,<sp/>error)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>Reset<sp/>the<sp/>form.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>(node_id)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>hideProposeChange(node_id);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>form.find(&apos;textarea&apos;)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.val(&apos;&apos;)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.add(form.find(&apos;input&apos;))</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.removeAttr(&apos;disabled&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>var<sp/>ul<sp/>=<sp/>$(&apos;#cl&apos;<sp/>+<sp/>(node_id<sp/>||<sp/>parent_id));</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>(ul.data(&apos;empty&apos;))<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$(ul).empty();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ul.data(&apos;empty&apos;,<sp/>false);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>insertComment(data.comment);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>var<sp/>ao<sp/>=<sp/>$(&apos;#ao&apos;<sp/>+<sp/>node_id);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ao.find(&apos;img&apos;).attr({&apos;src&apos;:<sp/>opts.commentBrightImage});</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>(node_id)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>if<sp/>this<sp/>was<sp/>a<sp/>&quot;root&quot;<sp/>comment,<sp/>remove<sp/>the<sp/>commenting<sp/>box</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>(the<sp/>user<sp/>can<sp/>get<sp/>it<sp/>back<sp/>by<sp/>reopening<sp/>the<sp/>comment<sp/>popup)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$(&apos;#ca&apos;<sp/>+<sp/>node_id).slideUp();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>},</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>error:<sp/>function(request,<sp/>textStatus,<sp/>error)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>form.find(&apos;textarea,input&apos;).removeAttr(&apos;disabled&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>showError(&apos;Oops,<sp/>there<sp/>was<sp/>a<sp/>problem<sp/>adding<sp/>the<sp/>comment.&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>/**</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*<sp/>Recursively<sp/>append<sp/>comments<sp/>to<sp/>the<sp/>main<sp/>comment<sp/>list<sp/>and<sp/>children</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*<sp/>lists,<sp/>creating<sp/>the<sp/>comment<sp/>tree.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>function<sp/>appendComments(comments,<sp/>ul)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$.each(comments,<sp/>function()<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>var<sp/>div<sp/>=<sp/>createCommentDiv(this);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>ul.append($(document.createElement(&apos;li&apos;)).html(div));</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>appendComments(this.children,<sp/>div.find(&apos;ul.comment-children&apos;));</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>To<sp/>avoid<sp/>stagnating<sp/>data,<sp/>don&apos;t<sp/>store<sp/>the<sp/>comments<sp/>children<sp/>in<sp/>data.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.children<sp/>=<sp/>null;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>div.data(&apos;comment&apos;,<sp/>this);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>/**</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*<sp/>After<sp/>adding<sp/>a<sp/>new<sp/>comment,<sp/>it<sp/>must<sp/>be<sp/>inserted<sp/>in<sp/>the<sp/>correct</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*<sp/>location<sp/>in<sp/>the<sp/>comment<sp/>tree.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>function<sp/>insertComment(comment)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>var<sp/>div<sp/>=<sp/>createCommentDiv(comment);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>To<sp/>avoid<sp/>stagnating<sp/>data,<sp/>don&apos;t<sp/>store<sp/>the<sp/>comments<sp/>children<sp/>in<sp/>data.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>comment.children<sp/>=<sp/>null;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>div.data(&apos;comment&apos;,<sp/>comment);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>var<sp/>ul<sp/>=<sp/>$(&apos;#cl&apos;<sp/>+<sp/>(comment.node<sp/>||<sp/>comment.parent));</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>var<sp/>siblings<sp/>=<sp/>getChildren(ul);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>var<sp/>li<sp/>=<sp/>$(document.createElement(&apos;li&apos;));</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>li.hide();</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>Determine<sp/>where<sp/>in<sp/>the<sp/>parents<sp/>children<sp/>list<sp/>to<sp/>insert<sp/>this<sp/>comment.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>for(i=0;<sp/>i<sp/>&lt;<sp/>siblings.length;<sp/>i++)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>(comp(comment,<sp/>siblings[i])<sp/>&lt;=<sp/>0)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$(&apos;#cd&apos;<sp/>+<sp/>siblings[i].id)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.parent()</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.before(li.html(div));</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>li.slideDown(&apos;fast&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>If<sp/>we<sp/>get<sp/>here,<sp/>this<sp/>comment<sp/>rates<sp/>lower<sp/>than<sp/>all<sp/>the<sp/>others,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>or<sp/>it<sp/>is<sp/>the<sp/>only<sp/>comment<sp/>in<sp/>the<sp/>list.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>ul.append(li.html(div));</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>li.slideDown(&apos;fast&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>function<sp/>acceptComment(id)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$.ajax({</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>type:<sp/>&apos;POST&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>url:<sp/>opts.acceptCommentURL,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>data:<sp/>{id:<sp/>id},</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>success:<sp/>function(data,<sp/>textStatus,<sp/>request)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$(&apos;#cm&apos;<sp/>+<sp/>id).fadeOut(&apos;fast&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$(&apos;#cd&apos;<sp/>+<sp/>id).removeClass(&apos;moderate&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>},</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>error:<sp/>function(request,<sp/>textStatus,<sp/>error)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>showError(&apos;Oops,<sp/>there<sp/>was<sp/>a<sp/>problem<sp/>accepting<sp/>the<sp/>comment.&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>function<sp/>deleteComment(id)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$.ajax({</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>type:<sp/>&apos;POST&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>url:<sp/>opts.deleteCommentURL,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>data:<sp/>{id:<sp/>id},</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>success:<sp/>function(data,<sp/>textStatus,<sp/>request)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>var<sp/>div<sp/>=<sp/>$(&apos;#cd&apos;<sp/>+<sp/>id);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>(data<sp/>==<sp/>&apos;delete&apos;)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>Moderator<sp/>mode:<sp/>remove<sp/>the<sp/>comment<sp/>and<sp/>all<sp/>children<sp/>immediately</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>div.slideUp(&apos;fast&apos;,<sp/>function()<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>div.remove();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>User<sp/>mode:<sp/>only<sp/>mark<sp/>the<sp/>comment<sp/>as<sp/>deleted</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>div</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.find(&apos;span.user-id:first&apos;)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.text(&apos;[deleted]&apos;).end()</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.find(&apos;div.comment-text:first&apos;)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.text(&apos;[deleted]&apos;).end()</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.find(&apos;#cm&apos;<sp/>+<sp/>id<sp/>+<sp/>&apos;,<sp/>#dc&apos;<sp/>+<sp/>id<sp/>+<sp/>&apos;,<sp/>#ac&apos;<sp/>+<sp/>id<sp/>+<sp/>&apos;,<sp/>#rc&apos;<sp/>+<sp/>id<sp/>+</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;,<sp/>#sp&apos;<sp/>+<sp/>id<sp/>+<sp/>&apos;,<sp/>#hp&apos;<sp/>+<sp/>id<sp/>+<sp/>&apos;,<sp/>#cr&apos;<sp/>+<sp/>id<sp/>+<sp/>&apos;,<sp/>#rl&apos;<sp/>+<sp/>id)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.remove();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>var<sp/>comment<sp/>=<sp/>div.data(&apos;comment&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>comment.username<sp/>=<sp/>&apos;[deleted]&apos;;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>comment.text<sp/>=<sp/>&apos;[deleted]&apos;;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>div.data(&apos;comment&apos;,<sp/>comment);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>},</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>error:<sp/>function(request,<sp/>textStatus,<sp/>error)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>showError(&apos;Oops,<sp/>there<sp/>was<sp/>a<sp/>problem<sp/>deleting<sp/>the<sp/>comment.&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>function<sp/>showProposal(id)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$(&apos;#sp&apos;<sp/>+<sp/>id).hide();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$(&apos;#hp&apos;<sp/>+<sp/>id).show();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$(&apos;#pr&apos;<sp/>+<sp/>id).slideDown(&apos;fast&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>function<sp/>hideProposal(id)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$(&apos;#hp&apos;<sp/>+<sp/>id).hide();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$(&apos;#sp&apos;<sp/>+<sp/>id).show();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$(&apos;#pr&apos;<sp/>+<sp/>id).slideUp(&apos;fast&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>function<sp/>showProposeChange(id)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$(&apos;#pc&apos;<sp/>+<sp/>id).hide();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$(&apos;#hc&apos;<sp/>+<sp/>id).show();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>var<sp/>textarea<sp/>=<sp/>$(&apos;#pt&apos;<sp/>+<sp/>id);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>textarea.val(textarea.data(&apos;source&apos;));</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$.fn.autogrow.resize(textarea[0]);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>textarea.slideDown(&apos;fast&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>function<sp/>hideProposeChange(id)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$(&apos;#hc&apos;<sp/>+<sp/>id).hide();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$(&apos;#pc&apos;<sp/>+<sp/>id).show();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>var<sp/>textarea<sp/>=<sp/>$(&apos;#pt&apos;<sp/>+<sp/>id);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>textarea.val(&apos;&apos;).removeAttr(&apos;disabled&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>textarea.slideUp(&apos;fast&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>function<sp/>toggleCommentMarkupBox(id)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$(&apos;#mb&apos;<sp/>+<sp/>id).toggle();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>/**<sp/>Handle<sp/>when<sp/>the<sp/>user<sp/>clicks<sp/>on<sp/>a<sp/>sort<sp/>by<sp/>link.<sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>function<sp/>handleReSort(link)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>var<sp/>classes<sp/>=<sp/>link.attr(&apos;class&apos;).split(/\s+/);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>for<sp/>(var<sp/>i=0;<sp/>i&lt;classes.length;<sp/>i++)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>(classes[i]<sp/>!=<sp/>&apos;sort-option&apos;)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>by<sp/>=<sp/>classes[i].substring(2);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>setComparator();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>Save/update<sp/>the<sp/>sortBy<sp/>cookie.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>var<sp/>expiration<sp/>=<sp/>new<sp/>Date();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>expiration.setDate(expiration.getDate()<sp/>+<sp/>365);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>document.cookie=<sp/>&apos;sortBy=&apos;<sp/>+<sp/>escape(by)<sp/>+</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;;expires=&apos;<sp/>+<sp/>expiration.toUTCString();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$(&apos;ul.comment-ul&apos;).each(function(index,<sp/>ul)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>var<sp/>comments<sp/>=<sp/>getChildren($(ul),<sp/>true);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>comments<sp/>=<sp/>sortComments(comments);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>appendComments(comments,<sp/>$(ul).empty());</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>/**</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*<sp/>Function<sp/>to<sp/>process<sp/>a<sp/>vote<sp/>when<sp/>a<sp/>user<sp/>clicks<sp/>an<sp/>arrow.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>function<sp/>handleVote(link)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>if<sp/>(!opts.voting)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>showError(&quot;You&apos;ll<sp/>need<sp/>to<sp/>login<sp/>to<sp/>vote.&quot;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>return;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>var<sp/>id<sp/>=<sp/>link.attr(&apos;id&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>if<sp/>(!id)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>Didn&apos;t<sp/>click<sp/>on<sp/>one<sp/>of<sp/>the<sp/>voting<sp/>arrows.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>return;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>If<sp/>it<sp/>is<sp/>an<sp/>unvote,<sp/>the<sp/>new<sp/>vote<sp/>value<sp/>is<sp/>0,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>Otherwise<sp/>it&apos;s<sp/>1<sp/>for<sp/>an<sp/>upvote,<sp/>or<sp/>-1<sp/>for<sp/>a<sp/>downvote.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>var<sp/>value<sp/>=<sp/>0;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>if<sp/>(id.charAt(1)<sp/>!=<sp/>&apos;u&apos;)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>value<sp/>=<sp/>id.charAt(0)<sp/>==<sp/>&apos;u&apos;<sp/>?<sp/>1<sp/>:<sp/>-1;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>The<sp/>data<sp/>to<sp/>be<sp/>sent<sp/>to<sp/>the<sp/>server.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>var<sp/>d<sp/>=<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>comment_id:<sp/>id.substring(2),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>value:<sp/>value</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>Swap<sp/>the<sp/>vote<sp/>and<sp/>unvote<sp/>links.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>link.hide();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$(&apos;#&apos;<sp/>+<sp/>id.charAt(0)<sp/>+<sp/>(id.charAt(1)<sp/>==<sp/>&apos;u&apos;<sp/>?<sp/>&apos;v&apos;<sp/>:<sp/>&apos;u&apos;)<sp/>+<sp/>d.comment_id)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>.show();</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>The<sp/>div<sp/>the<sp/>comment<sp/>is<sp/>displayed<sp/>in.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>var<sp/>div<sp/>=<sp/>$(&apos;div#cd&apos;<sp/>+<sp/>d.comment_id);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>var<sp/>data<sp/>=<sp/>div.data(&apos;comment&apos;);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>If<sp/>this<sp/>is<sp/>not<sp/>an<sp/>unvote,<sp/>and<sp/>the<sp/>other<sp/>vote<sp/>arrow<sp/>has</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>already<sp/>been<sp/>pressed,<sp/>unpress<sp/>it.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>if<sp/>((d.value<sp/>!==<sp/>0)<sp/>&amp;&amp;<sp/>(data.vote<sp/>===<sp/>d.value<sp/>*<sp/>-1))<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$(&apos;#&apos;<sp/>+<sp/>(d.value<sp/>==<sp/>1<sp/>?<sp/>&apos;d&apos;<sp/>:<sp/>&apos;u&apos;)<sp/>+<sp/>&apos;u&apos;<sp/>+<sp/>d.comment_id).hide();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$(&apos;#&apos;<sp/>+<sp/>(d.value<sp/>==<sp/>1<sp/>?<sp/>&apos;d&apos;<sp/>:<sp/>&apos;u&apos;)<sp/>+<sp/>&apos;v&apos;<sp/>+<sp/>d.comment_id).show();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>Update<sp/>the<sp/>comments<sp/>rating<sp/>in<sp/>the<sp/>local<sp/>data.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>data.rating<sp/>+=<sp/>(data.vote<sp/>===<sp/>0)<sp/>?<sp/>d.value<sp/>:<sp/>(d.value<sp/>-<sp/>data.vote);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>data.vote<sp/>=<sp/>d.value;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>div.data(&apos;comment&apos;,<sp/>data);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>Change<sp/>the<sp/>rating<sp/>text.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>div.find(&apos;.rating:first&apos;)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>.text(data.rating<sp/>+<sp/>&apos;<sp/>point&apos;<sp/>+<sp/>(data.rating<sp/>==<sp/>1<sp/>?<sp/>&apos;&apos;<sp/>:<sp/>&apos;s&apos;));</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>Send<sp/>the<sp/>vote<sp/>information<sp/>to<sp/>the<sp/>server.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$.ajax({</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>type:<sp/>&quot;POST&quot;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>url:<sp/>opts.processVoteURL,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>data:<sp/>d,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>error:<sp/>function(request,<sp/>textStatus,<sp/>error)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>showError(&apos;Oops,<sp/>there<sp/>was<sp/>a<sp/>problem<sp/>casting<sp/>that<sp/>vote.&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>/**</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*<sp/>Open<sp/>a<sp/>reply<sp/>form<sp/>used<sp/>to<sp/>reply<sp/>to<sp/>an<sp/>existing<sp/>comment.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>function<sp/>openReply(id)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>Swap<sp/>out<sp/>the<sp/>reply<sp/>link<sp/>for<sp/>the<sp/>hide<sp/>link</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$(&apos;#rl&apos;<sp/>+<sp/>id).hide();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$(&apos;#cr&apos;<sp/>+<sp/>id).show();</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>Add<sp/>the<sp/>reply<sp/>li<sp/>to<sp/>the<sp/>children<sp/>ul.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>var<sp/>div<sp/>=<sp/>$(renderTemplate(replyTemplate,<sp/>{id:<sp/>id})).hide();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$(&apos;#cl&apos;<sp/>+<sp/>id)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>.prepend(div)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>Setup<sp/>the<sp/>submit<sp/>handler<sp/>for<sp/>the<sp/>reply<sp/>form.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>.find(&apos;#rf&apos;<sp/>+<sp/>id)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>.submit(function(event)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>event.preventDefault();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>addComment($(&apos;#rf&apos;<sp/>+<sp/>id));</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>closeReply(id);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>})</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>.find(&apos;input[type=button]&apos;)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>.click(function()<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>closeReply(id);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>div.slideDown(&apos;fast&apos;,<sp/>function()<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$(&apos;#rf&apos;<sp/>+<sp/>id).find(&apos;textarea&apos;).focus();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>/**</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*<sp/>Close<sp/>the<sp/>reply<sp/>form<sp/>opened<sp/>with<sp/>openReply.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>function<sp/>closeReply(id)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>Remove<sp/>the<sp/>reply<sp/>div<sp/>from<sp/>the<sp/>DOM.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$(&apos;#rd&apos;<sp/>+<sp/>id).slideUp(&apos;fast&apos;,<sp/>function()<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$(this).remove();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>Swap<sp/>out<sp/>the<sp/>hide<sp/>link<sp/>for<sp/>the<sp/>reply<sp/>link</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$(&apos;#cr&apos;<sp/>+<sp/>id).hide();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$(&apos;#rl&apos;<sp/>+<sp/>id).show();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>/**</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*<sp/>Recursively<sp/>sort<sp/>a<sp/>tree<sp/>of<sp/>comments<sp/>using<sp/>the<sp/>comp<sp/>comparator.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>function<sp/>sortComments(comments)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>comments.sort(comp);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$.each(comments,<sp/>function()<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.children<sp/>=<sp/>sortComments(this.children);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>return<sp/>comments;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>/**</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*<sp/>Get<sp/>the<sp/>children<sp/>comments<sp/>from<sp/>a<sp/>ul.<sp/>If<sp/>recursive<sp/>is<sp/>true,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*<sp/>recursively<sp/>include<sp/>childrens&apos;<sp/>children.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>function<sp/>getChildren(ul,<sp/>recursive)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>var<sp/>children<sp/>=<sp/>[];</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>ul.children().children(&quot;[id^=&apos;cd&apos;]&quot;)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>.each(function()<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>var<sp/>comment<sp/>=<sp/>$(this).data(&apos;comment&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>(recursive)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>comment.children<sp/>=<sp/>getChildren($(this).find(&apos;#cl&apos;<sp/>+<sp/>comment.id),<sp/>true);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>children.push(comment);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>return<sp/>children;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>/**<sp/>Create<sp/>a<sp/>div<sp/>to<sp/>display<sp/>a<sp/>comment<sp/>in.<sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>function<sp/>createCommentDiv(comment)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>if<sp/>(!comment.displayed<sp/>&amp;&amp;<sp/>!opts.moderator)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>$(&apos;&lt;div<sp/>class=&quot;moderate&quot;&gt;Thank<sp/>you!<sp/><sp/>Your<sp/>comment<sp/>will<sp/>show<sp/>up<sp/>&apos;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>+<sp/>&apos;once<sp/>it<sp/>is<sp/>has<sp/>been<sp/>approved<sp/>by<sp/>a<sp/>moderator.&lt;/div&gt;&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>Prettify<sp/>the<sp/>comment<sp/>rating.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>comment.pretty_rating<sp/>=<sp/>comment.rating<sp/>+<sp/>&apos;<sp/>point&apos;<sp/>+</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>(comment.rating<sp/>==<sp/>1<sp/>?<sp/>&apos;&apos;<sp/>:<sp/>&apos;s&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>Make<sp/>a<sp/>class<sp/>(for<sp/>displaying<sp/>not<sp/>yet<sp/>moderated<sp/>comments<sp/>differently)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>comment.css_class<sp/>=<sp/>comment.displayed<sp/>?<sp/>&apos;&apos;<sp/>:<sp/>&apos;<sp/>moderate&apos;;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>Create<sp/>a<sp/>div<sp/>for<sp/>this<sp/>comment.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>var<sp/>context<sp/>=<sp/>$.extend({},<sp/>opts,<sp/>comment);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>var<sp/>div<sp/>=<sp/>$(renderTemplate(commentTemplate,<sp/>context));</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>If<sp/>the<sp/>user<sp/>has<sp/>voted<sp/>on<sp/>this<sp/>comment,<sp/>highlight<sp/>the<sp/>correct<sp/>arrow.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>if<sp/>(comment.vote)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>var<sp/>direction<sp/>=<sp/>(comment.vote<sp/>==<sp/>1)<sp/>?<sp/>&apos;u&apos;<sp/>:<sp/>&apos;d&apos;;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>div.find(&apos;#&apos;<sp/>+<sp/>direction<sp/>+<sp/>&apos;v&apos;<sp/>+<sp/>comment.id).hide();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>div.find(&apos;#&apos;<sp/>+<sp/>direction<sp/>+<sp/>&apos;u&apos;<sp/>+<sp/>comment.id).show();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>if<sp/>(opts.moderator<sp/>||<sp/>comment.text<sp/>!=<sp/>&apos;[deleted]&apos;)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>div.find(&apos;a.reply&apos;).show();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>(comment.proposal_diff)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>div.find(&apos;#sp&apos;<sp/>+<sp/>comment.id).show();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>(opts.moderator<sp/>&amp;&amp;<sp/>!comment.displayed)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>div.find(&apos;#cm&apos;<sp/>+<sp/>comment.id).show();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>(opts.moderator<sp/>||<sp/>(opts.username<sp/>==<sp/>comment.username))</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>div.find(&apos;#dc&apos;<sp/>+<sp/>comment.id).show();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>return<sp/>div;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>/**</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*<sp/>A<sp/>simple<sp/>template<sp/>renderer.<sp/>Placeholders<sp/>such<sp/>as<sp/>&lt;%id%&gt;<sp/>are<sp/>replaced</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*<sp/>by<sp/>context[&apos;id&apos;]<sp/>with<sp/>items<sp/>being<sp/>escaped.<sp/>Placeholders<sp/>such<sp/>as<sp/>&lt;#id#&gt;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*<sp/>are<sp/>not<sp/>escaped.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>function<sp/>renderTemplate(template,<sp/>context)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>var<sp/>esc<sp/>=<sp/>$(document.createElement(&apos;div&apos;));</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>function<sp/>handle(ph,<sp/>escape)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>var<sp/>cur<sp/>=<sp/>context;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$.each(ph.split(&apos;.&apos;),<sp/>function()<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cur<sp/>=<sp/>cur[this];</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>escape<sp/>?<sp/>esc.text(cur<sp/>||<sp/>&quot;&quot;).html()<sp/>:<sp/>cur;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>return<sp/>template.replace(/&lt;([%#])([\w\.]*)\1&gt;/g,<sp/>function()<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>handle(arguments[2],<sp/>arguments[1]<sp/>==<sp/>&apos;%&apos;<sp/>?<sp/>true<sp/>:<sp/>false);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>/**<sp/>Flash<sp/>an<sp/>error<sp/>message<sp/>briefly.<sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>function<sp/>showError(message)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$(document.createElement(&apos;div&apos;)).attr({&apos;class&apos;:<sp/>&apos;popup-error&apos;})</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>.append($(document.createElement(&apos;div&apos;))</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.attr({&apos;class&apos;:<sp/>&apos;error-message&apos;}).text(message))</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>.appendTo(&apos;body&apos;)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>.fadeIn(&quot;slow&quot;)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>.delay(2000)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>.fadeOut(&quot;slow&quot;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>/**<sp/>Add<sp/>a<sp/>link<sp/>the<sp/>user<sp/>uses<sp/>to<sp/>open<sp/>the<sp/>comments<sp/>popup.<sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$.fn.comment<sp/>=<sp/>function()<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>return<sp/>this.each(function()<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>var<sp/>id<sp/>=<sp/>$(this).attr(&apos;id&apos;).substring(1);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>var<sp/>count<sp/>=<sp/>COMMENT_METADATA[id];</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>var<sp/>title<sp/>=<sp/>count<sp/>+<sp/>&apos;<sp/>comment&apos;<sp/>+<sp/>(count<sp/>==<sp/>1<sp/>?<sp/>&apos;&apos;<sp/>:<sp/>&apos;s&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>var<sp/>image<sp/>=<sp/>count<sp/>&gt;<sp/>0<sp/>?<sp/>opts.commentBrightImage<sp/>:<sp/>opts.commentImage;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>var<sp/>addcls<sp/>=<sp/>count<sp/>==<sp/>0<sp/>?<sp/>&apos;<sp/>nocomment&apos;<sp/>:<sp/>&apos;&apos;;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$(this)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.append(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$(document.createElement(&apos;a&apos;)).attr({</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>href:<sp/>&apos;#&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;class&apos;:<sp/>&apos;sphinx-comment-open&apos;<sp/>+<sp/>addcls,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id:<sp/>&apos;ao&apos;<sp/>+<sp/>id</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>})</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.append($(document.createElement(&apos;img&apos;)).attr({</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>src:<sp/>image,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>alt:<sp/>&apos;comment&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>title:<sp/>title</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}))</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.click(function(event)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>event.preventDefault();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>show($(this).attr(&apos;id&apos;).substring(2));</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>})</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.append(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$(document.createElement(&apos;a&apos;)).attr({</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>href:<sp/>&apos;#&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;class&apos;:<sp/>&apos;sphinx-comment-close<sp/>hidden&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id:<sp/>&apos;ah&apos;<sp/>+<sp/>id</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>})</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.append($(document.createElement(&apos;img&apos;)).attr({</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>src:<sp/>opts.closeCommentImage,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>alt:<sp/>&apos;close&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>title:<sp/>&apos;close&apos;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}))</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.click(function(event)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>event.preventDefault();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>hide($(this).attr(&apos;id&apos;).substring(2));</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>})</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>};</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>var<sp/>opts<sp/>=<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>processVoteURL:<sp/>&apos;/_process_vote&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>addCommentURL:<sp/>&apos;/_add_comment&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>getCommentsURL:<sp/>&apos;/_get_comments&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>acceptCommentURL:<sp/>&apos;/_accept_comment&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>deleteCommentURL:<sp/>&apos;/_delete_comment&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>commentImage:<sp/>&apos;/static/_static/comment.png&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>closeCommentImage:<sp/>&apos;/static/_static/comment-close.png&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>loadingImage:<sp/>&apos;/static/_static/ajax-loader.gif&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>commentBrightImage:<sp/>&apos;/static/_static/comment-bright.png&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>upArrow:<sp/>&apos;/static/_static/up.png&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>downArrow:<sp/>&apos;/static/_static/down.png&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>upArrowPressed:<sp/>&apos;/static/_static/up-pressed.png&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>downArrowPressed:<sp/>&apos;/static/_static/down-pressed.png&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>voting:<sp/>false,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>moderator:<sp/>false</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>};</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>if<sp/>(typeof<sp/>COMMENT_OPTIONS<sp/>!=<sp/>&quot;undefined&quot;)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>opts<sp/>=<sp/>jQuery.extend(opts,<sp/>COMMENT_OPTIONS);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>var<sp/>popupTemplate<sp/>=<sp/>&apos;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&lt;div<sp/>class=&quot;sphinx-comments&quot;<sp/>id=&quot;sc&lt;%id%&gt;&quot;&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&lt;p<sp/>class=&quot;sort-options&quot;&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Sort<sp/>by:\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;a<sp/>href=&quot;#&quot;<sp/>class=&quot;sort-option<sp/>byrating&quot;&gt;best<sp/>rated&lt;/a&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;a<sp/>href=&quot;#&quot;<sp/>class=&quot;sort-option<sp/>byascage&quot;&gt;newest&lt;/a&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;a<sp/>href=&quot;#&quot;<sp/>class=&quot;sort-option<sp/>byage&quot;&gt;oldest&lt;/a&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&lt;/p&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&lt;div<sp/>class=&quot;comment-header&quot;&gt;Comments&lt;/div&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&lt;div<sp/>class=&quot;comment-loading&quot;<sp/>id=&quot;cn&lt;%id%&gt;&quot;&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>loading<sp/>comments...<sp/>&lt;img<sp/>src=&quot;&lt;%loadingImage%&gt;&quot;<sp/>alt=&quot;&quot;<sp/>/&gt;&lt;/div&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&lt;ul<sp/>id=&quot;cl&lt;%id%&gt;&quot;<sp/>class=&quot;comment-ul&quot;&gt;&lt;/ul&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&lt;div<sp/>id=&quot;ca&lt;%id%&gt;&quot;&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&lt;p<sp/>class=&quot;add-a-comment&quot;&gt;Add<sp/>a<sp/>comment\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(&lt;a<sp/>href=&quot;#&quot;<sp/>class=&quot;comment-markup&quot;<sp/>id=&quot;ab&lt;%id%&gt;&quot;&gt;markup&lt;/a&gt;):&lt;/p&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&lt;div<sp/>class=&quot;comment-markup-box&quot;<sp/>id=&quot;mb&lt;%id%&gt;&quot;&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>reStructured<sp/>text<sp/>markup:<sp/>&lt;i&gt;*emph*&lt;/i&gt;,<sp/>&lt;b&gt;**strong**&lt;/b&gt;,<sp/>\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;tt&gt;``code``&lt;/tt&gt;,<sp/>\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>code<sp/>blocks:<sp/>&lt;tt&gt;::&lt;/tt&gt;<sp/>and<sp/>an<sp/>indented<sp/>block<sp/>after<sp/>blank<sp/>line&lt;/div&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&lt;form<sp/>method=&quot;post&quot;<sp/>id=&quot;cf&lt;%id%&gt;&quot;<sp/>class=&quot;comment-form&quot;<sp/>action=&quot;&quot;&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;textarea<sp/>name=&quot;comment&quot;<sp/>cols=&quot;80&quot;&gt;&lt;/textarea&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;p<sp/>class=&quot;propose-button&quot;&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;a<sp/>href=&quot;#&quot;<sp/>id=&quot;pc&lt;%id%&gt;&quot;<sp/>class=&quot;show-propose-change&quot;&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Propose<sp/>a<sp/>change<sp/>&amp;#9657;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;/a&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;a<sp/>href=&quot;#&quot;<sp/>id=&quot;hc&lt;%id%&gt;&quot;<sp/>class=&quot;hide-propose-change&quot;&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Propose<sp/>a<sp/>change<sp/>&amp;#9663;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;/a&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;/p&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;textarea<sp/>name=&quot;proposal&quot;<sp/>id=&quot;pt&lt;%id%&gt;&quot;<sp/>cols=&quot;80&quot;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>spellcheck=&quot;false&quot;&gt;&lt;/textarea&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;input<sp/>type=&quot;submit&quot;<sp/>value=&quot;Add<sp/>comment&quot;<sp/>/&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;input<sp/>type=&quot;hidden&quot;<sp/>name=&quot;node&quot;<sp/>value=&quot;&lt;%id%&gt;&quot;<sp/>/&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;input<sp/>type=&quot;hidden&quot;<sp/>name=&quot;parent&quot;<sp/>value=&quot;&quot;<sp/>/&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&lt;/form&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&lt;/div&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&lt;/div&gt;&apos;;</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>var<sp/>commentTemplate<sp/>=<sp/>&apos;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&lt;div<sp/>id=&quot;cd&lt;%id%&gt;&quot;<sp/>class=&quot;sphinx-comment&lt;%css_class%&gt;&quot;&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&lt;div<sp/>class=&quot;vote&quot;&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;div<sp/>class=&quot;arrow&quot;&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;a<sp/>href=&quot;#&quot;<sp/>id=&quot;uv&lt;%id%&gt;&quot;<sp/>class=&quot;vote&quot;<sp/>title=&quot;vote<sp/>up&quot;&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;img<sp/>src=&quot;&lt;%upArrow%&gt;&quot;<sp/>/&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;/a&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;a<sp/>href=&quot;#&quot;<sp/>id=&quot;uu&lt;%id%&gt;&quot;<sp/>class=&quot;un<sp/>vote&quot;<sp/>title=&quot;vote<sp/>up&quot;&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;img<sp/>src=&quot;&lt;%upArrowPressed%&gt;&quot;<sp/>/&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;/a&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;/div&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;div<sp/>class=&quot;arrow&quot;&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;a<sp/>href=&quot;#&quot;<sp/>id=&quot;dv&lt;%id%&gt;&quot;<sp/>class=&quot;vote&quot;<sp/>title=&quot;vote<sp/>down&quot;&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;img<sp/>src=&quot;&lt;%downArrow%&gt;&quot;<sp/>id=&quot;da&lt;%id%&gt;&quot;<sp/>/&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;/a&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;a<sp/>href=&quot;#&quot;<sp/>id=&quot;du&lt;%id%&gt;&quot;<sp/>class=&quot;un<sp/>vote&quot;<sp/>title=&quot;vote<sp/>down&quot;&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;img<sp/>src=&quot;&lt;%downArrowPressed%&gt;&quot;<sp/>/&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;/a&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;/div&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&lt;/div&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&lt;div<sp/>class=&quot;comment-content&quot;&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;p<sp/>class=&quot;tagline<sp/>comment&quot;&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;span<sp/>class=&quot;user-id&quot;&gt;&lt;%username%&gt;&lt;/span&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;span<sp/>class=&quot;rating&quot;&gt;&lt;%pretty_rating%&gt;&lt;/span&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;span<sp/>class=&quot;delta&quot;&gt;&lt;%time.delta%&gt;&lt;/span&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;/p&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;div<sp/>class=&quot;comment-text<sp/>comment&quot;&gt;&lt;#text#&gt;&lt;/div&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;p<sp/>class=&quot;comment-opts<sp/>comment&quot;&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;a<sp/>href=&quot;#&quot;<sp/>class=&quot;reply<sp/>hidden&quot;<sp/>id=&quot;rl&lt;%id%&gt;&quot;&gt;reply<sp/>&amp;#9657;&lt;/a&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;a<sp/>href=&quot;#&quot;<sp/>class=&quot;close-reply&quot;<sp/>id=&quot;cr&lt;%id%&gt;&quot;&gt;reply<sp/>&amp;#9663;&lt;/a&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;a<sp/>href=&quot;#&quot;<sp/>id=&quot;sp&lt;%id%&gt;&quot;<sp/>class=&quot;show-proposal&quot;&gt;proposal<sp/>&amp;#9657;&lt;/a&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;a<sp/>href=&quot;#&quot;<sp/>id=&quot;hp&lt;%id%&gt;&quot;<sp/>class=&quot;hide-proposal&quot;&gt;proposal<sp/>&amp;#9663;&lt;/a&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;a<sp/>href=&quot;#&quot;<sp/>id=&quot;dc&lt;%id%&gt;&quot;<sp/>class=&quot;delete-comment<sp/>hidden&quot;&gt;delete&lt;/a&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;span<sp/>id=&quot;cm&lt;%id%&gt;&quot;<sp/>class=&quot;moderation<sp/>hidden&quot;&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;a<sp/>href=&quot;#&quot;<sp/>id=&quot;ac&lt;%id%&gt;&quot;<sp/>class=&quot;accept-comment&quot;&gt;accept&lt;/a&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;/span&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;/p&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;pre<sp/>class=&quot;proposal&quot;<sp/>id=&quot;pr&lt;%id%&gt;&quot;&gt;\</highlight></codeline>
<codeline><highlight class="normal">&lt;#proposal_diff#&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;/pre&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;ul<sp/>class=&quot;comment-children&quot;<sp/>id=&quot;cl&lt;%id%&gt;&quot;&gt;&lt;/ul&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;/div&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;div<sp/>class=&quot;clearleft&quot;&gt;&lt;/div&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&lt;/div&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&lt;/div&gt;&apos;;</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>var<sp/>replyTemplate<sp/>=<sp/>&apos;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&lt;li&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&lt;div<sp/>class=&quot;reply-div&quot;<sp/>id=&quot;rd&lt;%id%&gt;&quot;&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;form<sp/>id=&quot;rf&lt;%id%&gt;&quot;&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;textarea<sp/>name=&quot;comment&quot;<sp/>cols=&quot;80&quot;&gt;&lt;/textarea&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;input<sp/>type=&quot;submit&quot;<sp/>value=&quot;Add<sp/>reply&quot;<sp/>/&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;input<sp/>type=&quot;button&quot;<sp/>value=&quot;Cancel&quot;<sp/>/&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;input<sp/>type=&quot;hidden&quot;<sp/>name=&quot;parent&quot;<sp/>value=&quot;&lt;%id%&gt;&quot;<sp/>/&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;input<sp/>type=&quot;hidden&quot;<sp/>name=&quot;node&quot;<sp/>value=&quot;&quot;<sp/>/&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;/form&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&lt;/div&gt;\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&lt;/li&gt;&apos;;</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>$(document).ready(function()<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>init();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>});</highlight></codeline>
<codeline><highlight class="normal">})(jQuery);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">$(document).ready(function()<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>add<sp/>comment<sp/>anchors<sp/>for<sp/>all<sp/>paragraphs<sp/>that<sp/>are<sp/>commentable</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$(&apos;.sphinx-has-comment&apos;).comment();</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>highlight<sp/>search<sp/>words<sp/>in<sp/>search<sp/>results</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$(&quot;div.context&quot;).each(function()<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>var<sp/>params<sp/>=<sp/>$.getQueryParameters();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>var<sp/>terms<sp/>=<sp/>(params.q)<sp/>?<sp/>params.q[0].split(/\s+/)<sp/>:<sp/>[];</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>var<sp/>result<sp/>=<sp/>$(this);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$.each(terms,<sp/>function()<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>result.highlightText(this.toLowerCase(),<sp/>&apos;highlighted&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>});</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>directly<sp/>open<sp/>comment<sp/>window<sp/>if<sp/>requested</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>var<sp/>anchor<sp/>=<sp/>document.location.hash;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>if<sp/>(anchor.substring(0,<sp/>9)<sp/>==<sp/>&apos;#comment-&apos;)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$(&apos;#ao&apos;<sp/>+<sp/>anchor.substring(9)).click();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>document.location.hash<sp/>=<sp/>&apos;#s&apos;<sp/>+<sp/>anchor.substring(9);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal">});</highlight></codeline>
    </programlisting>
    <location file="src/docs/sphinx/_build/html/_static/websupport.js"/>
  </compounddef>
</doxygen>
